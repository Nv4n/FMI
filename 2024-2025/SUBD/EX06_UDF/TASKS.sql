SET SCHEMA FN24_3MI0700035;

-- T01
CREATE OR REPLACE FUNCTION EMP_AGE(EMP_NO CHAR(6))
    RETURNS INT
    SPECIFIC EMP_AGE
    RETURN SELECT YEAR(CURRENT_DATE - BIRTHDATE) AS AGE
           FROM DB2SAMPLE.EMP
           WHERE EMPNO = EMP_NO;


-- T02
CREATE OR REPLACE FUNCTION EMP_EXPERIENCE(EMP_NO CHAR(6))
    RETURNS INT
    SPECIFIC EMP_EXPERIENCE
    RETURN SELECT YEAR(CURRENT_DATE - HIREDATE) AS EXPERIENCE
           FROM DB2SAMPLE.EMP
           WHERE EMPNO = EMP_NO;

-- T03
CREATE OR REPLACE FUNCTION EMP_LNAME_SAL(EMP_NO CHAR(6))
    RETURNS TABLE
            (
                LNAME  VARCHAR(15),
                SALARY DEC(9,2)
            )
    SPECIFIC EMP_LNAME_SAL
    RETURN SELECT LASTNAME, SALARY
           FROM DB2SAMPLE.EMP E
           WHERE E.EMPNO = EMP_NO;

-- T04
DROP VIEW ELDERLY_EMP_INFO;
CREATE OR REPLACE VIEW ELDERLY_EMP_INFO AS
SELECT FN24_3MI0700035.EMP_AGE(EMPNO)                                         AS AGE,
       FN24_3MI0700035.EMP_EXPERIENCE(EMPNO)                                  AS EXPERIENCE,

       (SELECT T.SALARY FROM TABLE(FN24_3MI0700035.EMP_LNAME_SAL(E.EMPNO)) T) AS SALARY,
       SEX,
       EMPNO
FROM DB2SAMPLE.EMP E
WHERE FN24_3MI0700035.EMP_AGE(EMPNO) > 59 AND SEX = 'F'
   OR FN24_3MI0700035.EMP_AGE(EMPNO) > 62 AND SEX = 'M';

SELECT *
FROM ELDERLY_EMP_INFO;